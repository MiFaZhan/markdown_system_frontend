# 移动端适配优化方案

## 一、现状总结

### 已有适配

| 页面/组件             | 当前状态                                                               |
| --------------------- | ---------------------------------------------------------------------- |
| 全局                  | viewport 已配置，base.css 无固定宽度限制                               |
| Workspace             | useResponsive 监听屏幕宽度，<700px 自动收起侧栏，支持 overlay 抽屉模式 |
| Projects - 卡片视图   | 768px 以下变为单列                                                     |
| Projects - 列表视图   | 768px 以下隐藏日期/描述列                                              |
| ProjectsSectionHeader | 768px/495px 两级响应式布局                                             |

### 存在问题

| 问题                                  | 影响                  |
| ------------------------------------- | --------------------- |
| Login.vue 卡片固定 400px 宽           | 窄屏手机出现横向滚动  |
| Workspace 侧栏固定像素宽度(260/400px) | 小屏手机抽屉占比过大  |
| Projects.vue 外层 padding: 40px       | 小屏下内容区域过窄    |
| 对话框组件未适配                      | 弹窗可能超出屏幕宽度  |
| 触摸交互未优化                        | 部分按钮/操作区域过小 |

---

## 二、优化目标

1. **登录页**：卡片自适应屏幕宽度，消除横向滚动
2. **工作区**：侧栏在移动端使用百分比/相对宽度，优化触摸体验
3. **项目页**：调整外层容器边距，提升小屏内容利用率
4. **通用对话框**：确保所有弹窗在移动端不超出屏幕
5. **触摸友好**：按钮/可点击区域至少 44px

---

## 三、详细改动清单

### 3.1 登录页 (Login.vue)

**文件**: `src/views/Login.vue`

**改动内容**:

```css
/* 修改前 */
.login-card {
  width: 400px;
}

/* 修改后 */
.login-card {
  width: 100%;
  max-width: 400px;
  margin: 0 16px;
}

/* 新增移动端适配 */
@media (max-width: 480px) {
  .login-wrapper {
    padding: 16px;
  }

  .login-card {
    margin: 0;
  }

  .card-header h2 {
    font-size: 20px;
  }
}
```

---

### 3.2 工作区 (Workspace.vue)

**文件**: `src/views/Workspace.vue`

**改动内容**:

```css
/* 新增移动端样式 */
@media (max-width: 700px) {
  .workspace-layout.is-mobile .mobile-sidebar,
  .workspace-layout.is-mobile .mobile-outline {
    width: 85% !important;
    max-width: 300px;
  }
}
```

**文件**: `src/composables/useResponsive.js`

**改动内容**: 在移动端时动态调整侧栏宽度

```javascript
// 在 checkResponsive 函数中添加
if (width < 700) {
  sidebarWidth.value = Math.min(260, width * 0.85)
  outlineWidth.value = Math.min(300, width * 0.85)
}
```

---

### 3.3 文件树面板 (FileTreePanel.vue)

**文件**: `src/components/workspace/FileTreePanel.vue`

**改动内容**:

```css
/* 优化移动端触摸区域 */
@media (max-width: 700px) {
  .sidebar.mobile-sidebar {
    width: 85% !important;
    max-width: 300px;
  }

  .tree-node {
    padding: 8px;
    min-height: 44px;
  }

  .node-more {
    opacity: 1;
    padding: 8px;
  }

  .sidebar-header {
    height: 48px;
  }

  .sidebar-header .el-button {
    padding: 8px 12px;
  }
}
```

---

### 3.4 侧边面板 (SidePanel.vue)

**文件**: `src/components/workspace/SidePanel.vue`

**改动内容**:

```css
/* 优化移动端触摸区域 */
@media (max-width: 700px) {
  .outline-panel.mobile-outline {
    width: 85% !important;
    max-width: 300px;
  }

  .outline-header {
    height: 48px;
  }

  .outline-header .el-button {
    padding: 12px;
    min-width: 44px;
    min-height: 44px;
  }

  .export-option {
    padding: 16px 20px;
    min-height: 48px;
  }
}
```

---

### 3.5 项目页 (Projects.vue)

**文件**: `src/views/Projects.vue`

**改动内容**:

```css
/* 新增移动端适配 */
@media (max-width: 768px) {
  .projects-main {
    padding: 20px;
  }
}

@media (max-width: 480px) {
  .projects-main {
    padding: 12px;
  }

  .recycle-entry {
    right: 12px;
    bottom: 12px;
  }
}

/* 回收站对话框移动端适配 */
@media (max-width: 768px) {
  .recycle-controls {
    flex-wrap: wrap;
  }

  .recycle-controls .el-input,
  .recycle-controls .el-select {
    width: 100% !important;
    margin-bottom: 8px;
  }
}
```

---

### 3.6 项目表单对话框 (ProjectFormDialog.vue)

**文件**: `src/components/projects/ProjectFormDialog.vue`

**改动内容**:

```css
/* 新增移动端适配 */
@media (max-width: 768px) {
  .project-form-dialog :deep(.el-dialog) {
    width: 95% !important;
    margin: 20px auto !important;
  }

  .project-form-dialog :deep(.el-dialog__body) {
    padding: 16px;
  }

  .icon-grid {
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
  }

  .icon-item {
    width: 40px;
    height: 40px;
    font-size: 20px;
  }
}

@media (max-width: 480px) {
  .icon-grid {
    grid-template-columns: repeat(5, 1fr);
  }
}
```

---

### 3.7 项目属性对话框 (ProjectPropertyDialog.vue)

**文件**: `src/components/projects/ProjectPropertyDialog.vue`

**改动内容**:

```css
/* 新增移动端适配 */
@media (max-width: 768px) {
  .project-property-dialog :deep(.el-dialog) {
    width: 95% !important;
    margin: 20px auto !important;
  }

  .property-item {
    padding: 12px 0;
  }
}
```

---

### 3.8 项目卡片 (ProjectCard.vue)

**文件**: `src/components/projects/ProjectCard.vue`

**改动内容**:

```css
/* 优化移动端触摸区域 */
@media (max-width: 768px) {
  .project-card {
    min-height: 120px;
  }

  .more-btn {
    opacity: 1;
    width: 32px;
    height: 32px;
    padding: 6px;
  }

  .project-icon {
    font-size: 48px;
    width: 72px;
    height: 72px;
  }
}
```

---

### 3.9 项目列表项 (ProjectListItem.vue)

**文件**: `src/components/projects/ProjectListItem.vue`

**改动内容**:

```css
/* 优化移动端触摸区域 */
@media (max-width: 768px) {
  .project-list-item {
    min-height: 52px;
    padding: 14px 16px;
  }

  .list-actions .el-button {
    width: 36px;
    height: 36px;
    padding: 8px;
  }

  .list-name {
    font-size: 15px;
  }
}
```

---

### 3.10 标签栏 (TabsBar.vue)

**文件**: `src/components/TabsBar.vue`

**改动内容**:

```css
/* 优化移动端标签栏 */
@media (max-width: 700px) {
  .tabs-bar {
    padding: 0 8px;
  }

  .tab-item {
    padding: 8px 12px;
    min-width: auto;
    max-width: 120px;
  }

  .tab-name {
    max-width: 80px;
  }

  .toggle-btn {
    padding: 8px;
    min-width: 44px;
    min-height: 44px;
  }
}
```

---

### 3.11 全局对话框适配 (base.css)

**文件**: `src/assets/base.css`

**新增内容**:

```css
/* 全局对话框移动端适配 */
@media (max-width: 768px) {
  .el-dialog {
    width: 95% !important;
    max-width: 95% !important;
    margin: 20px auto !important;
  }

  .el-dialog__body {
    padding: 16px 20px;
    max-height: 60vh;
    overflow-y: auto;
  }

  .el-dialog__footer {
    padding: 12px 20px;
  }
}

@media (max-width: 480px) {
  .el-dialog {
    width: 98% !important;
    margin: 10px auto !important;
  }

  .el-dialog__header {
    padding: 12px 16px;
  }

  .el-dialog__title {
    font-size: 16px;
  }
}

/* 全局按钮触摸区域优化 */
@media (max-width: 768px) {
  .el-button--small {
    padding: 8px 12px;
    min-height: 36px;
  }

  .el-button.is-circle {
    min-width: 44px;
    min-height: 44px;
  }
}

/* 下拉菜单移动端适配 */
@media (max-width: 768px) {
  .el-dropdown-menu {
    max-width: 90vw;
  }

  .el-dropdown-menu__item {
    padding: 12px 16px;
    min-height: 44px;
    line-height: 1.4;
  }
}

/* 表格移动端适配 */
@media (max-width: 768px) {
  .el-table {
    font-size: 13px;
  }

  .el-table .cell {
    padding: 8px;
  }

  .el-table__body tr {
    min-height: 48px;
  }
}
```

---

## 四、实施顺序

1. **第一阶段 - 关键页面**
   - Login.vue（登录页）
   - Workspace.vue + useResponsive.js（工作区核心）
   - base.css 全局样式

2. **第二阶段 - 工作区组件**
   - FileTreePanel.vue
   - SidePanel.vue
   - TabsBar.vue

3. **第三阶段 - 项目页组件**
   - Projects.vue
   - ProjectFormDialog.vue
   - ProjectPropertyDialog.vue
   - ProjectCard.vue
   - ProjectListItem.vue

4. **第四阶段 - 验证与微调**
   - 在 Chrome DevTools 模拟多种设备尺寸测试
   - 真机测试（如有条件）
   - 根据测试结果微调样式

---

## 五、测试检查清单

### 断点测试

- [ ] 375px (iPhone SE)
- [ ] 390px (iPhone 12/13/14)
- [ ] 414px (iPhone Plus)
- [ ] 768px (iPad 竖屏)
- [ ] 1024px (iPad 横屏)

### 功能测试

- [ ] 登录页：卡片不超出屏幕，输入框可正常操作
- [ ] 项目列表：卡片/列表正常显示，操作按钮可点击
- [ ] 工作区：侧栏抽屉正常展开/收起，编辑器可用
- [ ] 对话框：所有弹窗不超出屏幕，内容可滚动
- [ ] 触摸操作：所有按钮/链接可准确点击

---

## 六、风险与注意事项

1. **Element Plus 组件样式覆盖**
   - 使用 `:deep()` 选择器穿透组件样式
   - 避免过度使用 `!important`，仅在必要时使用

2. **与深色模式兼容**
   - 新增的移动端样式需同时考虑深色模式下的表现
   - 可在 `@media (prefers-color-scheme: dark)` 中补充相应规则

3. **性能考虑**
   - 媒体查询不会影响性能
   - resize 事件已使用 requestAnimationFrame 优化

4. **向后兼容**
   - 所有改动都是增量式的，不影响桌面端现有体验
   - 使用 max-width 确保大屏设备不受影响
